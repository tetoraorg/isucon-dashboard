# The format of mysql slow query logs is like this.
#
# # Time: 2022-06-24T10:11:47.571111Z
# # User@Host: root[root] @ localhost []  Id:     9
# # Query_time: 0.014006  Lock_time: 0.000017 Rows_sent: 7  Rows_examined: 7
# SET timestamp=1656065507;
# show global variables like '%slow%';

[PARSER]
  name mysql
  format regex
  regex # Time: (?<time>[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}\:[0-9]{2}\:[0-9]{2}\.?[0-9]*)Z?\n# User\@Host:\s+\S*\[(?<user>\S*)\]\s+\@\s+(?<host>\S*).*\n# Query_time: (?<query_time>[0-9.]+)\s+Lock_time: (?<lock_time>[0-9.]+)\s+Rows_sent: (?<rows_sent>[0-9.]+)\s+Rows_examined: (?<rows_examined>[0-9.]+).*\nSET timestamp=(?<timestamp>[0-9]+);\n(?<query>[^#]+);
  types lock_time:float rows_sent:integer rows_examined:integer query_time:float timestamp:integer

[MULTILINE_PARSER]
  name multiline_mysql
  type regex
  flush_timeout 1000
  buffer on
  # Regex rules for multiline parsing
  #
  # prop |state name     |regex pattern                                                                                                                                               | next state
  # -----|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------
  rule    "start_state"   "/^# Time: (?<time>[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}\:[0-9]{2}\:[0-9]{2}\.?[0-9]*)Z?/"                                                                     "comment1"
  rule    "comment1"      "/^# User\@Host:\s+\S*\[(?<user>\S*)\]\s+\@\s+(?<host>\S*).*/"                                                                                               "comment2"
  rule    "comment2"      "/^# Query_time: (?<query_time>[0-9.]+)\s+Lock_time: (?<lock_time>[0-9.]+)\s+Rows_sent: (?<rows_sent>[0-9.]+)\s+Rows_examined: (?<rows_examined>[0-9.]+).*/" "timestamp"
  rule    "timestamp"     "/^SET timestamp=(?<timestamp>[0-9]+);/"                                                                                                                     "query"
  rule    "query"         "/^(?<query>[^#]+);/"                                                                                                                                        "query"

# The format of mariadb slow query logs is like this.
#
# # Time: 220702  5:05:29
# # User@Host: isucon[isucon] @ localhost []
# # Thread_id: 39  Schema:   QC_hit: No
# # Query_time: 1.000263  Lock_time: 0.000000  Rows_sent: 1  Rows_examined: 0
# # Rows_affected: 0  Bytes_sent: 63
# SET timestamp=1656705929;
# SELECT SLEEP(1);

[PARSER]
  name mariadb
  format regex
  regex # Time: (?<time>[0-9\s\:]+)\n# User\@Host:\s+\S*\[(?<user>\S*)\]\s+\@\s+(?<host>\S*).*\n# Thread_id:\s+(?<thread_id>[0-9]+)\s+Schema:\s+(?<schema>\S*)\s+QC_hit:\s+(?<qc_hit>\S*)\n# Query_time: (?<query_time>[0-9.]+)\s+Lock_time: (?<lock_time>[0-9.]+)\s+Rows_sent: (?<rows_sent>[0-9.]+)\s+Rows_examined: (?<rows_examined>[0-9.]+).*\n# Rows_affected: (?<rows_affected>[0-9.]+)\s+Bytes_sent: (?<bytes_sent>[0-9.]+)\nSET timestamp=(?<timestamp>[0-9]+);\n(?<query>[^#]+);
  types thread_id:integer query_time:float lock_time:float rows_sent:integer rows_examined:integer rows_affected:integer bytes_sent:integer timestamp:integer

[MULTILINE_PARSER]
  name multiline_mariadb
  type regex
  flush_timeout 1000
  buffer on
  # Regex rules for multiline parsing
  #
  # prop |state name     |regex pattern                                                                                                                                                     | next state
  # -----|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------
  rule    "start_state"   "/^# Time: (?<time>[0-9\s\:]+)/"                                                                                                                                   "comment1"
  rule    "comment1"      "/^# User\@Host:\s+\S*\[(?<user>\S*)\]\s+\@\s+(?<host>\S*).*/"                                                                                                     "comment2"
  rule    "comment2"      "/^# Thread_id:\s+(?<thread_id>[0-9]+)\s+Schema:\s+(?<schema>\S*)\s+QC_hit:\s+(?<qc_hit>\S*)/"                                                                     "comment3"
  rule    "comment3"      "/^# Query_time:\s+(?<query_time>[0-9.]+)\s+Lock_time:\s+(?<lock_time>[0-9.]+)\s+Rows_sent:\s+(?<rows_sent>[0-9.]+)\s+Rows_examined:\s+(?<rows_examined>[0-9.]+)/" "comment4"
  rule    "comment4"      "/^# Rows_affected:\s+(?<rows_affected>[0-9]+)\s+Bytes_sent:\s+(?<bytes_sent>[0-9]+)/"                                                                             "timestamp"
  rule    "timestamp"     "/^SET timestamp=(?<timestamp>[0-9]+);/"                                                                                                                           "query"
  rule    "query"         "/^(?<query>[^#]+);/"                                                                                                                                              "query"
